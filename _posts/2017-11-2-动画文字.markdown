---
layout:     post
title:      "æ–‡å­—åŠ¨æ¬¡æ‰“æ¬¡ï¼Œè®©æ–‡å­—åŠ¨æ€ç»˜åˆ¶å‡ºæ¥"
subtitle:   ""
date:       2017-11-2
author:     "JadynAi"
header-img: "img/20170819-blog-header-bg.jpg"
tags:
    - CanvasåŠ¨ç”»
---

*æœ¬æ–‡å±äºAndroidæŠ€æœ¯è®ºè¿°æ–‡ç« ï¼Œé˜…è¯»å®Œå¤§è‡´éœ€è¦äº”åˆ†é’Ÿ*   
>åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚ 

**æ²¡æ—¶é—´çš„å°ä¼™ä¼´å¯ä»¥ç›´æ¥è·³è¿‡æ–‡ç« ï¼Œ[ç‚¹å‡»é¡¹ç›®åœ°å€](https://github.com/JadynAi/LoadingLovely/tree/master/app/src/main/java/com/example/jadynai/loadinglovely/animtext)ï¼Œå¦‚æœå–œæ¬¢çš„è¯ï¼Œé¡ºæ‰‹ç»™ä¸ªstaré‚£æ˜¯æå¥½çš„ã€å¨‡ç¾â€¦â€¦ã€‘**

#### äºŒè¯ä¸è¯´ï¼Œæ•ˆæœå¥‰ä¸Šï¼
![](https://wx3.sinaimg.cn/mw690/a28b91d8gy1fp397j2ow4g20bb0bn1fn.gif)

#### çŸ¥è¯†ç‚¹åºåˆ—ï¼š
- Canvasç»˜åˆ¶
- TextPaint
- Path
- PathMeasureã€æµ‹é‡Pathã€‘

#### ä»£ç åˆ†æ
##### è·å–æ–‡å­—çš„è½®å»“Path
åœ¨`TextPaint`ä¸­æœ‰è¿™æ ·ä¸€ä¸ªæ–¹æ³•ï¼Œ`getTextPath`,å¦‚ä¸‹ï¼š

```
public void getTextPath(String text, int start, int end,
                            float x, float y, Path path) {
        if ((start | end | (end - start) | (text.length() - end)) < 0) {
            throw new IndexOutOfBoundsException();
        }
        nGetTextPath(mNativePaint, mNativeTypeface, mBidiFlags, text, start, end, x, y,
                path.mutateNI());
    }
```
ğŸ‘€å…¶ä¸­`nGetTextPath `é‡Œé¢æ˜¯è°ƒç”¨äº†ä¸€ä¸ªåŸç”Ÿå‡½æ•°ï¼Œå…·ä½“å®ç°ä¸å¿…ç†ä¼šã€‚åªéœ€è¦äº†è§£å‡½æ•°çš„å„ä¸ªå‚æ•°å°±å¯ä»¥äº†ã€‚


- å‚æ•°å«ä¹‰ï¼š
   - textï¼šæ–‡æœ¬å†…å®¹
   - startï¼šéœ€è¦æµ‹é‡çš„æ–‡æœ¬ä¸­çš„ç¬¬ä¸€ä¸ªå­—ç¬¦çš„ä¸‹æ ‡
   - endï¼šéœ€è¦æµ‹é‡çš„æ–‡æœ¬æœ€åä¸€ä¸ªå­—ç¬¦çš„ä¸‹æ ‡åŠ 1
   - xï¼šPathèµ·ç‚¹çš„åæ ‡X
   - yï¼šPathèµ·ç‚¹çš„åæ ‡Y
   - pathï¼šæœ€ç»ˆæµ‹é‡å¾—åˆ°çš„Path  

#### Pathåˆ†æ®µç»˜åˆ¶
[PathMeasure](http://blog.csdn.net/eclipsexys/article/details/51992473)è¿™ä¸ªç±»å¯ä»¥è¯´æ˜¯Pathç›¸å…³çš„å·¥å…·è§£æç±»ï¼Œé‡Œé¢å¤§å¤šæ˜¯åŸç”Ÿå‡½æ•°ï¼Œå®ç°ç»†èŠ‚ä¸å¿…æ·±ç©¶ã€‚åªéœ€è¦ä¼šä½¿ç”¨æ–¹æ³•å³å¯ã€‚
ç¬¬ä¸€æ­¥æˆ‘ä»¬å¾—åˆ°æ–‡å­—çš„è½®å»“Pathä¹‹åï¼Œè¿™ä¸€æ­¥å°†æ­¤pathæŒ‰æ®µç»˜åˆ¶å‡ºæ¥å³å¯ã€‚åœ¨ä»£ç ä¸­ï¼Œç”±`CanvasView`è¿™ä¸ªç±»æ¥å…·ä½“å®ç°ç»˜åˆ¶çš„è¯¦å°½æµç¨‹ã€‚çœ‹ä»£ç ï¼Œå°†æ–‡æœ¬è½®å»“Pathè®¾ç½®è¿›æ¥ï¼š

```
 		// ä¿ç•™ä¸€ä»½åŸå§‹Pathï¼Œç”¨ä½œç»˜åˆ¶æœ€ç»ˆå¡«è‰²çš„æ–‡å­—
        mOrignalPath = orignalPath;
        if (null == mPathMeasure) {
            mPathMeasure = new PathMeasure();
        }
        //å…ˆé‡ç½®ä¸€ä¸‹éœ€è¦æ˜¾ç¤ºåŠ¨ç”»çš„path
        mAnimPath.reset();
        mAnimPath.moveTo(0, 0);
        mPathMeasure.setPath(orignalPath, false);
        // getLengthï¼ˆï¼‰æ–¹æ³•è·å¾—çš„æ˜¯å½“å‰pathçš„é•¿åº¦ï¼›è€ŒnextContourï¼ˆï¼‰æ–¹æ³•æ˜¯å°†Pathåˆ‡æ¢åˆ°ä¸‹ä¸€æ®µPathï¼Œå¤šåº”ç”¨åœ¨å¤æ‚pathä¸­
        mTextCount = 0;
        // è®¡ç®—æ–‡å­—æ€»å…±æœ‰å¤šå°‘æ®µPath
        while (mPathMeasure.nextContour()) {
            mTextCount++;
        }
        // PathMeasureé‡æ–°è®¾ç½®ä¸€æ¬¡
        mPathMeasure.setPath(orignalPath, false);
        mPaint.setStyle(Paint.Style.STROKE);
```
- å…¶ä¸­æˆå‘˜å˜é‡mAnimPathï¼Œå³æ˜¯ç”¨åœ¨`onDraw()`æ–¹æ³•å†…ç”¨äºç»˜åˆ¶çš„Pathã€‚æˆ‘ä»¬ä¼šä¸åœåœ°é€šè¿‡`PathMeasure`åˆ·æ–°è¿™ä¸ªPathï¼Œç”¨äºåŠ¨ç”»æµç•…è¿è¡Œã€‚

æ¥ä¸‹æ¥æ˜¯å¼•æ“ä»£ç ï¼Œä½¿ç”¨çš„æ˜¯å±æ€§åŠ¨ç”»ï¼Œçœ‹ä»£ç å®ç°ï¼š

```
if (null == mValueAnimator) {
            // å¦‚æœä¸€ä¸ªæ–‡æœ¬PathåŒ…å«nä¸ªå°Pathï¼Œé‚£ä¹ˆå±æ€§åŠ¨ç”»ä¼šRepeatè¿è¡Œnæ¬¡ï¼Œæ¯ä¸€æ®µå°pathé»˜è®¤åŠ¨ç”»æ—¶é—´ä¸º900ms
            mValueAnimator = ValueAnimator.ofFloat(0.0f, 1.0f);
            mValueAnimator.setDuration(900);
            mValueAnimator.setInterpolator(new LinearInterpolator());
        }
        // å¼•æ“æ— é™æ¬¡é‡å¤å‘åŠ¨
        mValueAnimator.setRepeatCount(ValueAnimator.INFINITE);
        mValueAnimator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() {
            @Override
            public void onAnimationUpdate(ValueAnimator animation) {
                float value = (float) animation.getAnimatedValue();
                // å°†ä¸€æ®µå°Pathä»0%åˆ°100%èµ‹å€¼åˆ°mAnimPathä¸­ï¼Œè°ƒç”¨é‡ç»˜
                mPathMeasure.getSegment(0, mPathMeasure.getLength() * value, mAnimPath, true);
                invalidate();
            }
        });

        mValueAnimator.addListener(new AnimatorListenerAdapter() {
            @Override
            public void onAnimationRepeat(Animator animation) {
                super.onAnimationRepeat(animation);
                //ç»˜åˆ¶å®Œä¸€æ¡Pathä¹‹åï¼Œå†ç»˜åˆ¶ä¸‹ä¸€æ¡ï¼Œç›´åˆ°å®Œæˆä¸ºæ­¢ã€‚
                if (!mPathMeasure.nextContour()) {
                    animation.end();
                }
                invalidate();
            }
        });
```
- æ³¨é‡Šé‡Œå…·ä½“åŸå› äº¦å·²å†™æ˜ã€‚è¿™ç§å¼•æ“çš„è®¾ç½®ï¼Œå°±æ˜¯æ¯ä¸€å°æ®µPathä¸ç®¡é•¿çŸ­ï¼Œå…¶ç»˜åˆ¶æ—¶é—´éƒ½æ˜¯ç›¸ç­‰çš„ï¼Œä¼šé€ æˆåŠ¨ç”»çœ‹èµ·æ¥æ—¶æ…¢æ—¶å¿«ã€‚
- å…¶å®è¦è®©åŠ¨ç”»ä¸€ç›´åŒ€é€Ÿè·‘èµ·æ¥ä¹Ÿå¾ˆå®¹æ˜“ï¼Œå°±æ˜¯æå‰å°†åŸå§‹Pathæµ‹é‡ä¸€éï¼Œè®¾ç½®ä¸€ä¸ªæ€»æ—¶é—´ï¼Œç„¶åæ ¹æ®å°Pathçš„é•¿çŸ­æ¥æŒ‰ç…§æ¯”ä¾‹åˆ†é…æ—¶é—´ã€‚è¿™æ ·å³å¯ä½¿åŠ¨ç”»åŒ€é€Ÿè¿›è¡Œã€‚å…·ä½“ä»£ç ä¸å†å¤šè¨€ğŸ˜˜ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥è¯•è¯•ã€‚

å†çœ‹çœ‹`CanvasView`å†…çš„`onDraw()`æ–¹æ³•å®ç°ï¼š

```
@Override
    protected void onDraw(Canvas canvas) {
        super.onDraw(canvas);
        if (null != mPathMeasure && mPathMeasure.getLength() == 0) {
            mPaint.setStyle(Paint.Style.FILL);
            canvas.drawPath(mOrignalPath, mPaint);
            return;
        }
        canvas.drawPath(mAnimPath, mPaint);
    }

```
- è¿™é‡Œé¢çš„ä»£ç æ›´åŠ ç®€å•ï¼Œåœ¨Pathç»˜åˆ¶å®Œä¹‹å‰ï¼Œä¸€ç›´ç»˜åˆ¶mAnimPathå³å¯ã€‚Pathç»˜åˆ¶å®Œä¹‹åï¼Œè®¾ç½®ç”»ç¬”çš„ç»˜åˆ¶é£æ ¼ï¼Œå°†æ–‡å­—ç©ºç™½å¤„å¡«ä¸Šè‰²å³å¯ã€‚

### ä»¥ä¸Šã€‚å°±æ˜¯æœ¬æ¬¡é¡¹ç›®çš„ä¸»è¦æ€è·¯è§£æã€‚å¤§å®¶èµ°è¿‡è·¯è¿‡ä¸è¦é”™è¿‡ï¼Œç»™æ·»ä¸ª[Star](https://github.com/JadynAi/LoadingLovely/tree/master/app/src/main/java/com/example/jadynai/loadinglovely/animtext)å‘—ğŸ˜„ã€‚








