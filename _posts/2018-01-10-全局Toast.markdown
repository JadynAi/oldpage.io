---
layout:     post
title:      "手把手教你撸一个全局Toast（对话框、浮动通知栏）"
subtitle:   "当我们解决问题时，脑回路要怎么转？"
date:       2018-01-10
author:     "JadynAi"
header-img: "img/20180110-blog-header-bg.jpg"
tags:
    - 自定义组件
---

*本文属于Android技术论述文章，阅读完大致需要4m*   
>原创文章，转载请注明出处。 

**没时间的小伙伴可以直接跳过文章，[点击项目地址](https://github.com/JadynAi/GlobalWidget)，如果喜欢的话，顺手给个star那是极好的【娇羞……】**

#### 需求
- 话不多说，首先描述需求。产品的意思是在应用内做一个全局的顶部通知栏【可以理解为一个浮动的弹窗】，界面切换通知栏不会消失，而且横屏界面切换到竖屏界面通知栏的宽度也要随之改变，且具有类似Toast的自动消失属性，不过时间要自定义。

#### 思路分析
- 这种UI的特定需求，首先要想到的是能不能使用Android自带的组件去解决。那么来分析一下：
  - 针对整个应用的浮动通知栏，也就是说不依赖于某个特定的界面。排除PopupWindow、Snackbar；
  - 那么Dialog是否可行呢？结论是否定的，Dialog的创建时依赖于Context的，而且必须是有界面的Context。使用ApplicationContext不能创建Context。
  - 排除系统组件后，那么只能自定义控件解决问题了。
- 自定义控件：
  - 全局的东西，且位于所有界面之上，那么首先想到的是什么?没错，就是Window。
  - Window其实是一个比较抽象的概念存在，它还是依赖于View来展现的。使用方法也很简单，使用WindowManager的*addView()*方法即可。

#### 实现过程中的问题
- 确定了方案后，就是实现了。代码很简单，先获取WindowManager，然后将通知栏的布局添加进去即可。蹭蹭蹭，五分钟搞定代码，随手测试机运行。  咦？纳尼？我的通知栏呢？是不是哪里代码出问题了，蹭蹭蹭花了二十分钟检查代码。没毛病啊，就这么写的啊。
- ok，犹豫片刻。换了一台测试机，啪啪啪一运行。吧唧通知栏弹出来了。再回头一看出bug的测试机，魅族型号的。看来是一个兼容问题。
- 兼容问题，果断Google。一通搜索之后，哦……原来是少加了一个权限，拷贝粘贴加权限。魅族手机再次运行。纳尼，怎么还是运行不出来！




